<div class="admin-layout">
    <app-admin-header></app-admin-header>
    <div class="admin-main">
        <app-admin-sidebar></app-admin-sidebar>
        <main class="admin-content">
            <div class="container-fluid">
                <div class="card shadow-sm border-0 mb-3">
                    <div class="card-header bg-primary text-white py-2">
                        <h5 class="mb-0">Create New Product</h5>
                    </div>
                    <div class="card-body p-3">
                        <form [formGroup]="productForm" (ngSubmit)="onSubmit()">
                            <div class="row">
                                <!-- Left Column - Basic Info -->
                                <div class="col-md-6 pe-md-3">
                                    <h6 class="text-muted mb-2 border-bottom pb-1">Basic Information</h6>

                                    <!-- Product Name -->
                                    <div class="mb-2">
                                        <label for="name" class="form-label small fw-semibold mb-1">
                                            Product Name <span class="text-danger">*</span>
                                        </label>
                                        <input type="text" id="name" class="form-control form-control-sm"
                                            [class.is-invalid]="hasError('name')" formControlName="name"
                                            placeholder="Enter product name">
                                        <div class="invalid-feedback small" *ngIf="hasError('name')">
                                            {{ getErrorMessage('name') }}
                                        </div>
                                    </div>

                                    <!-- Brand and Category -->
                                    <div class="row">

                                        <div class="col-6 mb-2">
                                            <div class="d-flex justify-content-between align-items-center">
                                                <label for="brand" class="form-label small fw-semibold mb-1 mb-0">
                                                    Brand
                                                </label>
                                                <button type="button" class="btn btn-link btn-sm p-0"
                                                    (click)="openBrandDialog()">
                                                    + Add brand
                                                </button>
                                            </div>

                                            <select id="brand" class="form-select form-select-sm"
                                                [class.is-invalid]="hasError('brandId')" formControlName="brandId">
                                                <option value="">Select Brand</option>
                                                <option *ngFor="let brand of brands" [value]="brand.id">
                                                    {{ brand.name }}
                                                </option>
                                            </select>
                                        </div>

                                        <!-- Category Dropdown -->
                                        <div class="col-6 mb-2">
                                            <div class="d-flex justify-content-between align-items-center">
                                                <label for="category" class="form-label small fw-semibold mb-1">
                                                    Category <span class="text-danger">*</span>
                                                </label>
                                                <button type="button" class="btn btn-link btn-sm p-0"
                                                    (click)="openCategoryDialogForNew()">
                                                    + Add category
                                                </button>
                                            </div>

                                            <div class="dropdown">
                                                <button
                                                    class="btn btn-outline-secondary btn-sm dropdown-toggle w-100 text-start d-flex justify-content-between align-items-center"
                                                    [class.is-invalid]="hasError('categoryId')" type="button"
                                                    id="categoryDropdown" data-bs-toggle="dropdown"
                                                    aria-expanded="false">
                                                    <span class="dropdown-text text-truncate w-100">
                                                        <span *ngIf="!selectedCategory" class="text-muted">
                                                            Select Category
                                                        </span>
                                                        <span *ngIf="selectedCategory" class="text-dark">
                                                            {{ getSelectedCategoryPath() }}
                                                        </span>
                                                    </span>
                                                </button>

                                                <ul class="dropdown-menu w-100 category-dropdown"
                                                    aria-labelledby="categoryDropdown">
                                                    <ng-container
                                                        *ngTemplateOutlet="categoryTemplate; context: { categories: categories }"></ng-container>

                                                    <ng-template #categoryTemplate let-categories="categories">
                                                        <li *ngFor="let category of categories"
                                                            class="dropdown-submenu">
                                                            <div class="category-item">
                                                                <button type="button"
                                                                    class="dropdown-item d-flex justify-content-between align-items-center"
                                                                    [class]="getCategoryIndentClass(category.level || 0)"
                                                                    (click)="selectCategory(category, $event)">
                                                                    <span>{{ category.name }}</span>
                                                                    <i *ngIf="category.children?.length"
                                                                        class="fas fa-chevron-right small text-muted"></i>
                                                                </button>

                                                                <ul *ngIf="category.children?.length" class="submenu">
                                                                    <ng-container
                                                                        *ngTemplateOutlet="categoryTemplate; context: { categories: category.children }"></ng-container>
                                                                </ul>
                                                            </div>
                                                        </li>
                                                    </ng-template>
                                                </ul>
                                            </div>
                                            <div class="invalid-feedback small" *ngIf="hasError('categoryId')">
                                                {{ getErrorMessage('categoryId') }}
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Description -->
                                    <div class="mb-2">
                                        <label for="description" class="form-label small fw-semibold mb-1">
                                            Description <span class="text-danger">*</span>
                                        </label>
                                        <textarea id="description" class="form-control form-control-sm"
                                            [class.is-invalid]="hasError('description')" formControlName="description"
                                            rows="3" placeholder="Enter product description"></textarea>
                                        <div class="invalid-feedback small" *ngIf="hasError('description')">
                                            {{ getErrorMessage('description') }}
                                        </div>
                                    </div>

                                    <!-- Base Price -->
                                    <div class="mb-3">
                                        <label for="basePrice" class="form-label small fw-semibold mb-1">
                                            Base Price <span class="text-danger">*</span>
                                        </label>
                                        <div class="input-group input-group-sm">
                                            <span class="input-group-text">MMK</span>
                                            <!-- Visible input: formatted text -->
                                            <input type="text" class="form-control form-control-sm"
                                                [value]="displayPrice" (input)="onDisplayPriceInput($event)"
                                                mask="separator" thousandSeparator="," decimalMarker="."
                                                [dropSpecialCharacters]="false" placeholder="0.00" />
                                            <!-- Hidden real number input (bind to form control) -->
                                            <input type="hidden" formControlName="basePrice" />
                                        </div>
                                    </div>

                                    <!-- Enhanced Image Pool Section with Display Order Management -->
                                    <div class="mb-3">
                                        <div class="d-flex justify-content-between align-items-center mb-2">
                                            <label class="form-label small fw-semibold mb-0">Product Images</label>
                                            <small class="text-muted">{{ imagePool.length }}/10</small>
                                        </div>

                                        <!-- Image Pool Grid with Reordering Controls -->
                                        <div class="row g-2 mb-2" *ngIf="imagePool.length > 0">
                                            <div class="col-4 col-md-3" *ngFor="let img of imagePool; let i = index">
                                                <div class="position-relative image-pool-item">
                                                    <img [src]="img.previewUrl" alt="Preview"
                                                        class="img-thumbnail w-100"
                                                        style="height: 80px; object-fit: cover;">

                                                    <!-- Remove Button -->
                                                    <button type="button"
                                                        class="btn btn-danger btn-sm position-absolute"
                                                        style="top: -8px; right: -8px; font-size: 0.7rem; width: 20px; height: 20px; padding: 0;"
                                                        (click)="removeImageFromPool(img.id)">
                                                        <i class="fas fa-times"></i>
                                                    </button>

                                                    <!-- Main Image Button -->
                                                    <button type="button" class="btn btn-sm position-absolute"
                                                        style="bottom: -8px; left: -8px; font-size: 0.7rem; width: 24px; height: 20px; padding: 0;"
                                                        [class.btn-success]="img.isMain"
                                                        [class.btn-warning]="!img.isMain" (click)="setMainImage(img.id)"
                                                        title="Set as main image">
                                                        <i class="fas fa-star"></i>
                                                    </button>

                                                    <!-- Reorder Controls -->
                                                    <div class="position-absolute reorder-controls"
                                                        style="top: -8px; left: -8px; display: flex; flex-direction: column; gap: 2px;">
                                                        <button type="button" class="btn btn-secondary btn-sm"
                                                            style="font-size: 0.6rem; width: 18px; height: 16px; padding: 0;"
                                                            [disabled]="!canMoveUp(img.id)"
                                                            (click)="moveImageUp(img.id)" title="Move up">
                                                            <i class="fas fa-chevron-up"></i>
                                                        </button>
                                                        <button type="button" class="btn btn-secondary btn-sm"
                                                            style="font-size: 0.6rem; width: 18px; height: 16px; padding: 0;"
                                                            [disabled]="!canMoveDown(img.id)"
                                                            (click)="moveImageDown(img.id)" title="Move down">
                                                            <i class="fas fa-chevron-down"></i>
                                                        </button>
                                                    </div>

                                                    <!-- Main Badge -->
                                                    <span *ngIf="img.isMain" class="badge bg-success position-absolute"
                                                        style="top: 2px; left: 2px; font-size: 0.6rem;">Main</span>

                                                    <!-- Display Order Badge -->
                                                    <span class="badge bg-primary position-absolute"
                                                        style="bottom: 2px; right: 2px; font-size: 0.6rem;">{{ i + 1
                                                        }}</span>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Upload Button -->
                                        <button type="button" class="btn btn-outline-primary btn-sm w-100"
                                            [disabled]="imagePool.length >= 10" (click)="triggerImageUpload()">
                                            <i class="fas fa-plus me-1"></i>
                                            Add Images ({{ imagePool.length }}/10)
                                        </button>
                                        <input type="file" #productFileInput class="d-none"
                                            (change)="onImagesSelected($event)" accept="image/*" multiple>
                                    </div>
                                </div>

                                <!-- Right Column - Options -->
                                <div class="col-md-6 ps-md-3">
                                    <div
                                        class="d-flex justify-content-between align-items-center mb-2 border-bottom pb-1">
                                        <h6 class="text-muted mb-0">Product Options</h6>
                                        <button type="button" class="btn btn-outline-primary btn-sm py-0 px-2"
                                            (click)="addOption()">
                                            <i class="fas fa-plus me-1"></i>
                                            Add Option
                                        </button>
                                    </div>

                                    <!-- ðŸ”½ Scrollable Options List Container -->
                                    <div style="height: 400px; overflow-y: auto;" class="border rounded p-2 bg-white">
                                        <div formArrayName="options" class="options-container">
                                            <div *ngFor="let option of options.controls; let i = index"
                                                [formGroupName]="i"
                                                class="option-box mb-2 border-start border-primary ps-2">
                                                <div class="d-flex justify-content-between align-items-center mb-1">
                                                    <small class="text-primary fw-semibold">Option {{ i + 1 }}</small>
                                                    <button type="button"
                                                        class="btn btn-outline-danger btn-sm py-0 px-1"
                                                        (click)="removeOption(i)">
                                                        <i class="fas fa-times"></i>
                                                    </button>
                                                </div>

                                                <div class="row g-2">
                                                    <!-- Option Type -->
                                                    <div class="col-5">
                                                        <div class="input-group input-group-sm">
                                                            <select class="form-select" formControlName="id"
                                                                (change)="onOptionTypeChange(i)"
                                                                [class.is-invalid]="option.get('id')?.invalid && option.get('id')?.touched">
                                                                <option value="">Select Type</option>
                                                                <option *ngFor="let type of optionTypes"
                                                                    [value]="type.id">
                                                                    {{ type.name }}</option>
                                                            </select>
                                                            <button type="button" class="btn btn-outline-secondary"
                                                                (click)="openAddOptionDialog()">+</button>
                                                        </div>
                                                        <div class="invalid-feedback small"
                                                            *ngIf="option.get('id')?.invalid && option.get('id')?.touched">
                                                            Option type is required
                                                        </div>
                                                    </div>


                                                    <!-- Option Values Dropdown -->
                                                    <div class="col-7">
                                                        <div *ngIf="option.get('id')?.value; else noTypeSelected"
                                                            class="dropdown">
                                                            <button
                                                                class="btn btn-outline-secondary btn-sm dropdown-toggle w-100 text-start d-flex justify-content-between align-items-center"
                                                                type="button" [id]="'optionDropdown' + i"
                                                                data-bs-toggle="dropdown" aria-expanded="false"
                                                                [class.is-invalid]="option.get('values')?.invalid && option.get('values')?.touched">
                                                                <span class="dropdown-text">
                                                                    <span *ngIf="getSelectedValuesCount(i) === 0"
                                                                        class="text-muted">Select values</span>
                                                                    <span *ngIf="getSelectedValuesCount(i) > 0"
                                                                        class="text-dark">{{ getSelectedValuesCount(i)
                                                                        }}
                                                                        selected</span>
                                                                </span>
                                                            </button>

                                                            <ul class="dropdown-menu w-100"
                                                                [attr.aria-labelledby]="'optionDropdown' + i">
                                                                <li
                                                                    *ngFor="let value of getOptionValues(option.get('id')?.value)">
                                                                    <div class="dropdown-item-check px-3 py-1">
                                                                        <div class="form-check">
                                                                            <input class="form-check-input"
                                                                                type="checkbox"
                                                                                [id]="'option_' + i + '_' + value.id"
                                                                                [checked]="isValueSelected(i, value.value)"
                                                                                (change)="toggleOptionValue(i, value.value)" />
                                                                            <label class="form-check-label small"
                                                                                [for]="'option_' + i + '_' + value.id">
                                                                                {{ value.value }}
                                                                            </label>
                                                                        </div>
                                                                    </div>
                                                                </li>
                                                                <li
                                                                    *ngIf="getOptionValues(option.get('id')?.value)?.length === 0">
                                                                    <span class="dropdown-item-text small text-muted">No
                                                                        values available</span>
                                                                </li>
                                                                <li>
                                                                    <button type="button"
                                                                        class="dropdown-item text-primary small"
                                                                        (click)="openAddOptionValueDialog(option.get('id')?.value)">
                                                                        + Add new value
                                                                    </button>
                                                                </li>
                                                            </ul>

                                                            <div class="invalid-feedback small"
                                                                *ngIf="option.get('values')?.invalid && option.get('values')?.touched">
                                                                Please select at least one value
                                                            </div>
                                                        </div>

                                                        <ng-template #noTypeSelected>
                                                            <button
                                                                class="btn btn-outline-secondary btn-sm w-100 text-start"
                                                                type="button" disabled>
                                                                <span class="text-muted small">Select type first</span>
                                                            </button>
                                                        </ng-template>

                                                        <!-- Selected Values Display -->
                                                        <div class="selected-values mt-1"
                                                            *ngIf="option.get('values')?.value?.length > 0">
                                                            <span class="badge bg-light text-dark border me-1 mb-1"
                                                                *ngFor="let val of option.get('values')?.value">
                                                                {{ val }}
                                                                <button type="button"
                                                                    class="btn-close btn-close-sm ms-1"
                                                                    (click)="removeOptionValue(i, val)"
                                                                    aria-label="Remove"></button>
                                                            </span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- No Options Message -->
                                            <div *ngIf="options.length === 0" class="text-center py-2">
                                                <small class="text-muted">No options added yet</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>




                            </div>

                            <!-- Enhanced Variants Section with Individual Removal -->
                            <div class="row mt-3" *ngIf="productVariants.length > 0">
                                <div class="col-12">
                                    <div class="card border">
                                        <div class="card-header bg-light py-2">
                                            <div class="d-flex justify-content-between align-items-center">
                                                <h6 class="mb-0">
                                                    Product Variants ({{ productVariants.length }})
                                                    <span *ngIf="!hasOptionsSelected" class="badge bg-info ms-2">Default
                                                        Mode</span>
                                                    <span *ngIf="hasOptionsSelected"
                                                        class="badge bg-success ms-2">Options
                                                        Mode</span>
                                                </h6>
                                                <div class="d-flex gap-2">
                                                    <button type="button" class="btn btn-outline-secondary btn-sm"
                                                        (click)="applyBulkStock()">
                                                        Set Stock
                                                    </button>
                                                    <button type="button" class="btn btn-sm"
                                                        [class.btn-primary]="bulkAssignmentMode"
                                                        [class.btn-outline-primary]="!bulkAssignmentMode"
                                                        (click)="toggleBulkAssignmentMode()">
                                                        <i class="fas fa-images me-1"></i>
                                                        {{ bulkAssignmentMode ? 'Exit Bulk Mode' : 'Bulk Assign Images'
                                                        }}
                                                    </button>
                                                </div>
                                            </div>

                                            <div *ngIf="bulkAssignmentMode" class="mt-2 p-2 bg-light rounded">
                                                <div class="row align-items-center">
                                                    <div class="col-md-4">
                                                        <div class="d-flex gap-2">
                                                            <button type="button"
                                                                class="btn btn-outline-secondary btn-sm"
                                                                (click)="selectAllVariants()">
                                                                Select All
                                                            </button>
                                                            <button type="button"
                                                                class="btn btn-outline-secondary btn-sm"
                                                                (click)="clearVariantSelection()">
                                                                Clear
                                                            </button>
                                                        </div>
                                                        <small class="text-muted">{{ getSelectedVariantsCount() }}
                                                            variants
                                                            selected</small>
                                                    </div>
                                                    <div class="col-md-5">
                                                        <select class="form-select form-select-sm"
                                                            [(ngModel)]="selectedImageForBulkAssignment"
                                                            [ngModelOptions]="{standalone: true}">
                                                            <option value="">Select action</option>
                                                            <option value="clear">ðŸš« Remove Images (No Images)</option>
                                                            <option *ngFor="let img of imagePool; let i = index"
                                                                [value]="img.id">
                                                                Image {{ i + 1 }}{{ img.isMain ? ' (Main)' : '' }}
                                                            </option>
                                                        </select>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <button type="button" class="btn btn-success btn-sm w-100"
                                                            [disabled]="!selectedImageForBulkAssignment || getSelectedVariantsCount() === 0"
                                                            (click)="applyBulkImageAssignment()">
                                                            <i class="fas fa-check me-1"></i>
                                                            {{ selectedImageForBulkAssignment === 'clear' ?
                                                            'Remove from Selected' : 'Apply to Selected' }}
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div style="max-height: 400px; overflow-y: auto;"
                                            class="border rounded p-2 bg-white card-body p-0">
                                            <div class="table-responsive">
                                                <table class="table table-sm table-hover mb-0">
                                                    <thead class="table-light">
                                                        <tr>
                                                            <th scope="col" class="ps-3" style="width: 50px;">
                                                                <input *ngIf="bulkAssignmentMode" type="checkbox"
                                                                    class="form-check-input"
                                                                    [checked]="getSelectedVariantsCount() === variants.length && variants.length > 0"
                                                                    (change)="getSelectedVariantsCount() === variants.length ? clearVariantSelection() : selectAllVariants()">
                                                                <span *ngIf="!bulkAssignmentMode">#</span>
                                                            </th>
                                                            <th scope="col" style="width: 250px;">Variant</th>
                                                            <th scope="col" style="width: 200px;">Image Assignment</th>
                                                            <th scope="col" style="width: 120px;">Price (MMK)</th>
                                                            <th scope="col" style="width: 100px;">Stock</th>
                                                            <th scope="col">SKU</th>
                                                            <th scope="col" style="width: 80px;">Actions</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody formArrayName="variants">
                                                        <tr *ngFor="let variant of variants.controls; let i = index"
                                                            [formGroupName]="i"
                                                            [class.table-primary]="bulkAssignmentMode && isVariantSelected(i)"
                                                            [class.table-warning]="productVariants[i].isDefault">
                                                            <td class="ps-3">
                                                                <input *ngIf="bulkAssignmentMode" type="checkbox"
                                                                    class="form-check-input"
                                                                    [checked]="isVariantSelected(i)"
                                                                    (change)="toggleVariantSelection(i)">
                                                                <span *ngIf="!bulkAssignmentMode">{{ i + 1 }}</span>
                                                            </td>

                                                            <td>
                                                                <div class="variant-options">
                                                                    <div class="fw-semibold small mb-1">
                                                                        {{ getVariantDisplayLabel(i) }}
                                                                    </div>
                                                                    <div *ngIf="productVariants[i]?.isDefault"
                                                                        class="small text-muted">
                                                                        <i class="fas fa-info-circle me-1"></i>
                                                                        This is the default variant for products without
                                                                        options
                                                                    </div>
                                                                    <div *ngIf="!productVariants[i]?.isDefault && productVariants[i].options.length > 0"
                                                                        class="small text-muted">
                                                                        <span
                                                                            *ngFor="let option of productVariants[i].options; let last = last">
                                                                            {{ option.optionName }}: {{ option.valueName
                                                                            }}{{ !last ? ', ' : '' }}
                                                                        </span>
                                                                    </div>
                                                                </div>
                                                            </td>


                                                            <td>
                                                                <div class="d-flex align-items-center gap-2">

                                                                    <div *ngIf="getAssignedImage(i)"
                                                                        class="flex-shrink-0">
                                                                        <img [src]="getAssignedImage(i)!.previewUrl"
                                                                            alt="Assigned image" class="img-thumbnail"
                                                                            style="width: 50px; height: 50px; object-fit: cover;">
                                                                    </div>

                                                                    <div *ngIf="!getAssignedImage(i)"
                                                                        class="flex-shrink-0 d-flex align-items-center justify-content-center border rounded"
                                                                        style="width: 50px; height: 50px; background-color: #f8f9fa;">
                                                                        <i class="fas fa-image text-muted"></i>
                                                                    </div>

                                                                    <div *ngIf="!bulkAssignmentMode"
                                                                        class="flex-grow-1">
                                                                        <select class="form-select form-select-sm"
                                                                            formControlName="assignedImageId">
                                                                            <option value="">No Image</option>
                                                                            <option
                                                                                *ngFor="let img of getAvailableImagesForVariant(); let imgIndex = index"
                                                                                [value]="img.id">
                                                                                Image {{ imgIndex + 1 }}{{ img.isMain ?
                                                                                '
                                                                                (Main)' : '' }}
                                                                            </option>
                                                                        </select>
                                                                    </div>

                                                                    <div *ngIf="bulkAssignmentMode" class="flex-grow-1">
                                                                        <span *ngIf="getAssignedImage(i)"
                                                                            class="text-success small">
                                                                            <i class="fas fa-check-circle me-1"></i>Has
                                                                            Image
                                                                        </span>
                                                                        <span *ngIf="!getAssignedImage(i)"
                                                                            class="text-muted small">
                                                                            <i class="fas fa-circle me-1"></i>No Image
                                                                        </span>
                                                                    </div>
                                                                </div>
                                                            </td>


                                                            <td>

                                                                <app-price-display-input
                                                                    [control]="getFormControl(variant.get('price'))"></app-price-display-input>

                                                            </td>

                                                            <td>
                                                                <input type="number"
                                                                    class="form-control form-control-sm"
                                                                    formControlName="stock" min="0" step="1">
                                                            </td>

                                                            <td class="small text-muted">
                                                                {{ getSkuForVariant(i) }}
                                                            </td>

                                                            <td>
                                                                <div class="d-flex gap-1">
                                                                    <button *ngIf="canRemoveVariant(i)" type="button"
                                                                        class="btn btn-outline-danger btn-sm"
                                                                        style="padding: 2px 6px;"
                                                                        (click)="removeVariant(i)"
                                                                        title="Remove this variant">
                                                                        <i class="fas fa-trash"
                                                                            style="font-size: 0.75rem;"></i>
                                                                    </button>


                                                                    <span *ngIf="!canRemoveVariant(i)"
                                                                        class="badge bg-warning text-dark small"
                                                                        title="Default variant cannot be removed">
                                                                        Default
                                                                    </span>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Info Panel for Variant Management -->
                            <div class="row mt-2" *ngIf="productVariants.length > 0">
                                <div class="col-12">
                                    <div class="alert alert-info alert-sm py-2">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <small>
                                                    <i class="fas fa-info-circle me-1"></i>
                                                    <strong>Variant Management:</strong>
                                                    {{ hasOptionsSelected ?
                                                    'Options-based variants are generated automatically.'
                                                    : 'Using default variant for simple products.' }}
                                                </small>
                                            </div>
                                            <div class="col-md-6">
                                                <small>
                                                    <i class="fas fa-trash me-1"></i>
                                                    <strong>Removal:</strong>
                                                    {{ hasOptionsSelected ?
                                                    'Click the trash icon to remove unwanted variants.'
                                                    : 'Default variant cannot be removed.' }}
                                                </small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Submit Button -->
                            <div class="row mt-3">
                                <div class="col-12">
                                    <div class="d-flex justify-content-end">
                                        <button type="button" class="btn btn-outline-secondary btn-sm me-2"
                                            (click)="resetForm()">
                                            Cancel
                                        </button>
                                        <button [disabled]="productForm.invalid || loading.submission" type="submit"
                                            class="btn btn-primary btn-sm">
                                            <span *ngIf="loading.submission"
                                                class="spinner-border spinner-border-sm me-1"></span>
                                            {{ loading.submission ? 'Creating Product...' : 'Create Product' }}
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Error Messages -->
                            <div *ngIf="errorMessage" class="alert alert-danger alert-sm mt-2">
                                {{ errorMessage }}
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </main>
    </div>
    <app-admin-footer></app-admin-footer>

    <app-brand-dialog [(visible)]="brandDialogVisible" [editingBrand]="null" (save)="onBrandCreated()">
    </app-brand-dialog>

    <app-category-dialog [(visible)]="categoryDialogVisible" [editingCategory]="editingCategory"
        [parentCategoryForNew]="parentCategoryForNew" [categoryDropdown]="categoryDropdown"
        (save)="onCategorySaved($event)">
    </app-category-dialog>

    <app-option-dialog [(visible)]="optionDialogVisible" [editingOption]="editingOption"
        (save)="onOptionTypeSaved($event)">
    </app-option-dialog>

    <app-option-value-dialog [(visible)]="optionValueDialogVisible" [selectedOption]="selectedOptionTypeForDialog"
        [editingValue]="editingOptionValue" (save)="onOptionValueSaved($event)">
    </app-option-value-dialog>