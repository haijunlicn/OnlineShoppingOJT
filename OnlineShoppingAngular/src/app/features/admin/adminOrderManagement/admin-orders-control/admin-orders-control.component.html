<div class="admin-layout">
  <app-admin-header></app-admin-header>
  <div class="admin-main">
    <app-admin-sidebar></app-admin-sidebar>
    <main class="admin-content">
<div class="min-h-screen bg-gradient">
  <!-- Header -->
  <div class="header">
    <div class="header-content">
      <div class="header-left">
        <div class="logo-container">
          <svg class="logo-icon" fill="currentColor" viewBox="0 0 24 24">
            <path d="M7.5 21L3 16.5l1.4-1.4L7.5 18.2L19.1 6.6L20.5 8L7.5 21z"/>
          </svg>
        </div>
        <div>
          <h1 class="header-title">Order Management</h1>
          <p class="header-subtitle">Manage and track all orders</p>
        </div>
      </div>
      <div class="header-actions">
        <button class="icon-button">
          <svg class="icon" fill="currentColor" viewBox="0 0 24 24">
            <path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.89 2 2 2zm6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z"/>
          </svg>
        </button>
        <button class="icon-button">
          <svg class="icon" fill="currentColor" viewBox="0 0 24 24">
            <path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.82,11.69,4.82,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.43-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"/>
          </svg>
        </button>
        <!-- Export Dropdown -->
        <div class="dropdown">
          <button class="export-button dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
            <svg class="icon" fill="currentColor" viewBox="0 0 24 24">
              <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
            </svg>
            Export
          </button>
          <ul class="dropdown-menu">
            <li>
              <a class="dropdown-item" href="javascript:void(0)" (click)="exportOrdersToPdf()">
                <i class="pi pi-file-pdf me-2"></i>Export PDF
              </a>
            </li>
            <li>
              <a class="dropdown-item" href="javascript:void(0)" (click)="exportOrdersToExcel()">
                <i class="pi pi-file-excel me-2"></i>Export Excel
              </a>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <div class="main-content">
    <!-- Stats Cards -->
    <div class="stats-grid">
      <div class="stat-card stat-card-blue">
        <div class="stat-content">
          <div class="stat-info">
            <p class="stat-label">Total Orders</p>
            <p class="stat-value">{{ totalOrders }}</p>
            <p class="stat-trend">
              <svg class="trend-icon" fill="currentColor" viewBox="0 0 24 24">
                <path d="M16,6L18.29,8.29L13.41,13.17L9.41,9.17L2,16.59L3.41,18L9.41,12L13.41,16L19.71,9.71L22,12V6H16Z"/>
              </svg>
              +12% from last month
            </p>
          </div>
          <div class="stat-icon stat-icon-blue">
            <svg class="icon-large" fill="currentColor" viewBox="0 0 24 24">
              <path d="M19,7H18V6A2,2 0 0,0 16,4H8A2,2 0 0,0 6,6V7H5A1,1 0 0,0 4,8V19A3,3 0 0,0 7,22H17A3,3 0 0,0 20,19V8A1,1 0 0,0 19,7M8,6H16V7H8V6M18,19A1,1 0 0,1 17,20H7A1,1 0 0,1 6,19V9H8V11H10V9H14V11H16V9H18V19Z"/>
            </svg>
          </div>
        </div>
      </div>

      <div class="stat-card stat-card-amber">
        <div class="stat-content">
          <div class="stat-info">
            <p class="stat-label">Pending Orders</p>
            <p class="stat-value">{{ pendingOrders }}</p>
            <p class="stat-trend">Requires attention</p>
          </div>
          <div class="stat-icon stat-icon-amber">
            <svg class="icon-large" fill="currentColor" viewBox="0 0 24 24">
              <path d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M16.2,16.2L11,13V7H12.5V12.2L17,14.9L16.2,16.2Z"/>
            </svg>
          </div>
        </div>
      </div>

      <div class="stat-card stat-card-purple">
        <div class="stat-content">
          <div class="stat-info">
            <p class="stat-label">Processing</p>
            <p class="stat-value">{{ processingOrders }}</p>
            <p class="stat-trend">In progress</p>
          </div>
          <div class="stat-icon stat-icon-purple">
            <svg class="icon-large" fill="currentColor" viewBox="0 0 24 24">
              <path d="M12,4V2A10,10 0 0,0 2,12H4A8,8 0 0,1 12,4Z"/>
            </svg>
          </div>
        </div>
      </div>

      <div class="stat-card stat-card-emerald">
        <div class="stat-content">
          <div class="stat-info">
            <p class="stat-label">Total Revenue</p>
            <p class="stat-value">{{ totalRevenue.toLocaleString() }} MMK</p>
            <p class="stat-trend">
              <svg class="trend-icon" fill="currentColor" viewBox="0 0 24 24">
                <path d="M16,6L18.29,8.29L13.41,13.17L9.41,9.17L2,16.59L3.41,18L9.41,12L13.41,16L19.71,9.71L22,12V6H16Z"/>
              </svg>
              +8% from last month
            </p>
          </div>
          <div class="stat-icon stat-icon-emerald">
            <svg class="icon-large" fill="currentColor" viewBox="0 0 24 24">
              <path d="M7,15H9C9,16.08 10.37,17 12,17C13.63,17 15,16.08 15,15C15,13.9 13.96,13.5 11.76,12.97C9.64,12.44 7,11.78 7,9C7,7.21 8.47,5.69 10.5,5.18V3H13.5V5.18C15.53,5.69 17,7.21 17,9H15C15,7.92 13.63,7 12,7C10.37,7 9,7.92 9,9C9,10.1 10.04,10.5 12.24,11.03C14.36,11.56 17,12.22 17,15C17,16.79 15.53,18.31 13.5,18.82V21H10.5V18.82C8.47,18.31 7,16.79 7,15Z"/>
            </svg>
          </div>
        </div>
      </div>
    </div>

    <!-- Filters -->
    <div class="filter-card">
      <div class="filter-content" style="display: flex; flex-wrap: wrap; align-items: center; gap: 1rem;">
        <div class="search-container" style="flex: 1 1 250px;">
          <svg class="search-icon" fill="currentColor" viewBox="0 0 24 24">
            <path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"/>
          </svg>
          <input 
            type="text" 
            class="search-input" 
            placeholder="Search orders, customers, or emails..."
            [(ngModel)]="searchTerm"
            (input)="filterOrders()"
          />
        </div>
        <div class="filter-selects" style="display: flex; gap: 0.75rem; align-items: center;">
          <select class="filter-select" [(ngModel)]="statusFilter" (change)="filterOrders()">
            <option value="all">All Status</option>
            <option *ngFor="let s of uniqueStatuses" [value]="s" [ngStyle]="s === 'cancelled' ? {'color': '#dc2626', 'font-weight': 'bold'} : {}">{{ getStatusLabel(s) }}</option>
          </select>
          <select class="filter-select" [(ngModel)]="priorityFilter" (change)="filterOrders()">
            <option value="all">All Priority</option>
            <option *ngFor="let p of uniquePriorities" [value]="p">{{ p | titlecase }}</option>
          </select>
          <button type="button" (click)="clearFilters()" style="margin-left: 0.5rem; padding: 0.5rem 1rem; border-radius: 0.375rem; border: 1px solid #e2e8f0; background: #fff; color: #222; font-weight: 500; cursor: pointer;">Clear Filters</button>
        </div>
      </div>
    </div>

    <!-- Order Status Update Section -->
    <div *ngIf="selectedOrderIds.length > 0" class="order-status-update-section" style="margin: 1rem 0; display: flex; align-items: center; gap: 1rem; background: #fff; border-radius: 0.75rem; box-shadow: 0 1px 3px rgba(0,0,0,0.08); padding: 1rem;">
      <span style="font-weight: 500;">{{ selectedOrderIds.length }} selected</span>
      <label style="margin: 0 0.5rem 0 0;">
        <select [(ngModel)]="bulkStatus">
          <option value="">Select status</option>
          
          <option value="order_confirmed">Order Confirmed</option>
          <option value="packed">Packed</option>
          <option value="out_for_delivery">Out for Delivery</option>
          <option value="delivered">Delivered</option>
          <option value="cancelled" style="color: #dc2626; font-weight: bold;">Cancelled</option>
        </select>
      </label>
      <label style="flex: 1; margin: 0 0.5rem;">
        <input [(ngModel)]="bulkNote" placeholder="Note (optional)" style="width: 100%; padding: 0.5rem; border-radius: 0.375rem; border: 1px solid #e2e8f0;" />
      </label>
      <button (click)="confirmBulkStatusUpdate()" [disabled]="!bulkStatus || bulkStatusLoading" style="padding: 0.5rem 1.5rem; border-radius: 0.375rem; background: #2563eb; color: #fff; border: none; font-weight: 500; cursor: pointer;">Update Status</button>
      <span *ngIf="bulkStatusLoading" style="margin-left: 1rem; color: #64748b;">Updating...</span>
      <span *ngIf="bulkStatusError" style="margin-left: 1rem; color: #dc2626;">{{ bulkStatusError }}</span>
    </div>

    <!-- Orders Table -->
    <div class="table-container">
      <div class="table-header">
        <h3 class="table-title">Orders</h3>
        <div class="table-actions">
          <span class="table-count">{{ filteredOrders.length }} orders</span>
        </div>
      </div>
      
      <div class="table-wrapper">
        <table class="orders-table">
          <thead>
            <tr>
              <th class="table-header-cell">
                <input type="checkbox" [checked]="isAllSelected()" (change)="toggleSelectAll($event)" />
              </th>
              <th class="table-header-cell">
                <div class="header-content">
                  <span>Order ID</span>
                  <svg class="sort-icon" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M7,10L12,15L17,10H7Z"/>
                  </svg>
                </div>
              </th>
              <th class="table-header-cell">
                <div class="header-content">
                  <span>Customer</span>
                </div>
              </th>
              <th class="table-header-cell">
                <div class="header-content">
                  <span>Date</span>
                </div>
              </th>
              <th class="table-header-cell">
                <div class="header-content">
                  <span>Status</span>
                </div>
              </th>
              <th class="table-header-cell">
                <div class="header-content">
                  <span>Items</span>
                </div>
              </th>
              <th class="table-header-cell">
                <div class="header-content">
                  <span>Total</span>
                </div>
              </th>
              <th class="table-header-cell">
                <div class="header-content">
                  <span>Priority</span>
                </div>
              </th>
              <th class="table-header-cell">
                <div class="header-content">
                  <span>Actions</span>
                </div>
              </th>
            </tr>
          </thead>
          <tbody>
            <tr 
              *ngFor="let order of filteredOrders" 
              class="table-row"
              [ngClass]="getPriorityClass(order.priority)"
            >
              <td class="table-cell">
                <input type="checkbox" [checked]="isSelected(order)" (change)="toggleSelectOrder(order, $event)" />
              </td>
              <td class="table-cell">
                <div class="order-id-cell">
                  <span class="order-id-text">{{ order.id }}</span>
                </div>
              </td>
              <td class="table-cell">
                <div class="customer-cell">
                  <div class="avatar-small">
                    {{ order.avatar }}
                  </div>
                  <div class="customer-info">
                    <div class="customer-name">{{ order.customer }}</div>
                    <div class="customer-email">{{ order.email }}</div>
                  </div>
                </div>
              </td>
              <td class="table-cell">
                <div class="date-cell">
                  <div class="date-text">{{ order.date }}</div>
                  <div class="time-text">{{ order.time }}</div>
                </div>
              </td>
              <td class="table-cell">
                <div class="status-cell">
                  <div class="status-badge" [ngClass]="getStatusClass(order.status)">
                    <div class="status-dot" [ngClass]="getStatusDotClass(order.status)"></div>
                    <span>{{ getStatusLabel(order.status) }}</span>
                  </div>
                </div>
              </td>
              <td class="table-cell">
                <div class="items-cell">
                  <span class="items-count">{{ order.items }} items</span>
                </div>
              </td>
              <td class="table-cell">
                <div class="total-cell">
                  <span class="total-amount">{{ order.total.toLocaleString() }} MMK</span>
                </div>
              </td>
              <td class="table-cell">
                <div class="priority-cell">
                  <span class="priority-badge" [ngClass]="getPriorityClass(order.priority)">
                    {{ order.priority }}
                  </span>
                </div>
              </td>
              <td class="table-cell">
                <div class="actions-cell">
                  <button class="view-details-btn" (click)="viewOrder(order)" title="View Details">
                    <svg class="view-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                      <path stroke-linecap="round" stroke-linejoin="round" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.477 0 8.268 2.943 9.542 7-1.274 4.057-5.065 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                    </svg>
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions-card">
      <div class="quick-actions-header">
        <svg class="icon" fill="currentColor" viewBox="0 0 24 24">
          <path d="M16,4C16.88,4 17.67,4.38 18.18,5L20,7H22V9H20.82L19,11H17L15.18,9H14.82L13,11H11L9.18,9H8.82L7,11H5L3.18,9H2V7H4L5.82,5C6.33,4.38 7.12,4 8,4H16M16,6H8C7.45,6 7,6.45 7,7C7,7.55 7.45,8 8,8H16C16.55,8 17,7.55 17,7C17,6.45 16.55,6 16,6Z"/>
        </svg>
        <h3>Quick Actions</h3>
      </div>
      <div class="quick-actions-grid">
        <button class="quick-action-btn quick-action-amber" (click)="reviewPending()">
          <svg class="icon" fill="currentColor" viewBox="0 0 24 24">
            <path d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M16.2,16.2L11,13V7H12.5V12.2L17,14.9L16.2,16.2Z"/>
          </svg>
          Review Pending ({{ pendingOrders }})
        </button>
        <button class="quick-action-btn quick-action-purple" (click)="processShipments()">
          <svg class="icon" fill="currentColor" viewBox="0 0 24 24">
            <path d="M18,18.5A1.5,1.5 0 0,1 16.5,17A1.5,1.5 0 0,1 18,15.5A1.5,1.5 0 0,1 19.5,17A1.5,1.5 0 0,1 18,18.5M19.5,9.5L21.46,12H17V9.5M6,18.5A1.5,1.5 0 0,1 4.5,17A1.5,1.5 0 0,1 6,15.5A1.5,1.5 0 0,1 7.5,17A1.5,1.5 0 0,1 6,18.5M20,8H17V4H3C1.89,4 1,4.89 1,6V17H3A3,3 0 0,0 6,20A3,3 0 0,0 9,17H15A3,3 0 0,0 18,20A3,3 0 0,0 21,17H23V12L20,8Z"/>
          </svg>
          Process Shipments
        </button>
        <button class="quick-action-btn quick-action-blue" (click)="generateReports()">
          <svg class="icon" fill="currentColor" viewBox="0 0 24 24">
            <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
          </svg>
          Generate Reports
        </button>
      </div>
    </div>

    <!-- Single Status Update Modal -->
    <div class="modal-backdrop" *ngIf="showSingleStatusModal">
      <div class="modal">
        <h3>Update Order Status</h3>
        <label>Status:
          <select [(ngModel)]="singleStatus">
            <option value="">Select status</option>
            <option *ngFor="let s of statusList"
                    [value]="s"
                    [disabled]="!allowedTransitions[selectedOrderForStatus?.status || 'pending'].includes(s)"
                    [ngStyle]="s === 'cancelled' ? {'color': '#dc2626', 'font-weight': 'bold'} : {}">
              {{ getStatusLabel(s) }}
            </option>
          </select>
        </label>
        <label>Note:
          <textarea [(ngModel)]="singleNote" rows="2"></textarea>
        </label>
        <div class="modal-actions">
          <button (click)="confirmSingleStatusUpdate()" [disabled]="!singleStatus">Update</button>
          <button (click)="closeSingleStatusModal()">Cancel</button>
        </div>
        <div *ngIf="singleStatusLoading">Updating...</div>
        <div *ngIf="singleStatusError" class="error">{{ singleStatusError }}</div>
      </div>
    </div>
  </div>
</div>
</main>
  </div>

  <app-admin-footer></app-admin-footer>