<ng-container *ngIf="!showEditDiscount">
<ng-container *ngIf="!showProductSelectionModal">
  <div class="discount-management" (click)="hideAllMenus()">
    <!-- Header -->
      <div class="header" style="margin-top: -40px; padding-top: 20px;">
      <div class="header-content">
        <h1>Discount Management</h1>
        <p>Create and manage promotional campaigns</p>
      </div>
      <button class="create-btn" (click)="createDiscount()">
        <span class="plus-icon">+</span>
        Create Discount
      </button>
    </div>

      <!-- Combined Stats + Search + Filters Row -->
      <div class="stats-search-filter-row" style="margin-top: -30px;" >
           <!-- Search + Filters -->
           <div class="search-filter-group">
      <div class="search-container">
        <div class="search-icon">üîç</div>
        <input 
          type="text"
          class="search-input"
          placeholder="Search discounts..."
          [(ngModel)]="searchTerm"
          (input)="onSearch()"
        >
      </div>
      <div class="filter-buttons">
        <button 
          *ngFor="let filter of filterOptions"
          class="filter-btn"
          [class.active]="currentFilter === filter.key"
          (click)="setFilter(filter.key)"
        >
          {{ filter.label }}
        </button>
      </div>
    </div>
        <!-- Stat Cards -->
        <div class="stat-cards-group">
          <div class="stat-card" style="width: 218px;">
            <div class="stat-content">
              <div class="stat-label">Active Discounts</div>
              <div class="stat-value green">{{ activeDiscounts }}</div>
            </div>
            <div class="stat-indicator green"></div>
          </div>
         
          <div class="stat-card">
            <div class="stat-content">
              <div class="stat-label">Total Offers</div>
              <div class="stat-value purple">{{ totalMechanisms }}</div>
            </div>
            <div class="stat-indicator purple"></div>
          </div>
         
        </div>
     
      </div>

      <!-- Discount Table -->
      <div class="discount-section" style="margin-top: -30px; ">
        <div class="section-header" style="height: 50px;">
          <h2>All Discounts</h2>
         
      </div>
      
      <div class="table-container" *ngIf="!loading; else loadingTemplate">
        <table class="discount-table">
          <thead>
            <tr>
                <th class="text-center" style="width: 48px;">No.</th>
                <th class="sortable" style="width: 180px;" (click)="sortBy('name')">
                <span>Discount Name</span>
                <span class="sort-icon">‚ÜïÔ∏è</span>
              </th>
                <th class="sortable" style="width: 120px;" (click)="sortBy('status')">
                <span>Status</span>
                <span class="sort-icon">‚ÜïÔ∏è</span>
              </th>
                <th class="sortable" style="width: 160px;" (click)="sortBy('startDate')">
                <span>Valid Period</span>
                <span class="sort-icon">‚ÜïÔ∏è</span>
              </th>
             
                <th class="text-center" style="width: 80px;">Active</th>
                <th class="text-center" style="width: 120px;">Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr 
                *ngFor="let discount of filteredDiscounts; let i = index; trackBy: trackByDiscountId"
              class="discount-row"
              [class.expired]="isExpired(discount)"
              [class.inactive]="!isActive(discount) && !isExpired(discount)"
              (click)="hideAllDropdowns(); hideAllMenus()"
            >
                <!-- No. -->
                <td class="text-center">{{ i + 1 }}</td>
              <!-- Discount Name & Description -->
              <td class="discount-info">
                <div class="discount-name">{{ discount.name }}</div>
                <div class="discount-description" *ngIf="discount.description">
                  {{ discount.description | slice:0:60 }}{{ discount.description && discount.description.length > 60 ? '...' : '' }}
                </div>
              </td>

              <!-- Status -->
              <td>
                <span 
                  class="status-badge"
                  [class.active]="isActive(discount)"
                  [class.inactive]="!isActive(discount) && !isExpired(discount)"
                  [class.expired]="isExpired(discount)"
                >
                  {{ isActive(discount) ? 'ACTIVE' : (isExpired(discount) ? 'EXPIRED' : 'INACTIVE') }}
                </span>
              </td>

              <!-- Valid Period -->
              <td class="date-range">
                  <div class="date-start"> <b>From</b> {{ formatDate(discount.startDate) }} <b>To</b> {{ formatDate(discount.endDate) }}</div>
                  
              </td>

              

              <!-- Toggle Switch -->
              <td class="text-center">
                <label class="toggle-switch">
                  <input 
                    type="checkbox"
                    [checked]="discount.isActive"
                    (change)="toggleDiscountStatus(discount)"
                  >
                  <span class="toggle-slider"></span>
                </label>
              </td>

              <!-- Actions -->
              <td class="text-center">
                <div class="action-buttons">
                    <button class="icon-btn view-btn"  (click)="viewDiscountDetails(discount)" title="View Details">
                      <i class="fas fa-eye"></i>
                  </button>
                    <button class="icon-btn edit-btn" (click)="editDiscount(discount)" title="Edit">
                      <i class="fas fa-pen-to-square"></i>
                  </button>
                    <button class="icon-btn delete-btn"(click)="deleteDiscount(discount.id)" title="Delete">
                      <i class="fas fa-trash"></i>
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <ng-template #loadingTemplate>
        <div class="loading-table">
          <div class="loading-spinner"></div>
          <p>Loading discounts...</p>
        </div>
      </ng-template>

      <div class="empty-state" *ngIf="!loading && filteredDiscounts.length === 0">
        <div class="empty-icon">üìã</div>
        <h3>No discounts found</h3>
        <p>Try adjusting your search or filter criteria</p>
      </div>
    </div>
  </div>

  <!-- Modal content remains the same -->
  <div class="edit-popup-backdrop" *ngIf="showEditPopup && !showProductSelectionModal" (click)="closeEditPopup()"></div>
  <div class="edit-popup modern-modal" *ngIf="showEditPopup && !showProductSelectionModal">
    <!-- Modal content unchanged -->
  </div>
</ng-container>

<ng-container *ngIf="showProductSelectionModal">
  <app-product-selection
    [selectedProducts]="mechanismProductSelectionProducts"
    (onProductsSelected)="onProductsSelected($event)"
    (onBack)="onProductSelectionBack()"
  ></app-product-selection>
  </ng-container>
</ng-container>

<ng-container *ngIf="showEditDiscount">
  <app-new-edit-discount
    [discount]="editDiscountData"
    (close)="onEditDiscountClose($event)">
  </app-new-edit-discount>
</ng-container>
