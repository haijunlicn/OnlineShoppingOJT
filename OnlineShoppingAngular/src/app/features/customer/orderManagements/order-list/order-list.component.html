<app-header></app-header>

<main class="main-content">
  <!-- Integrated Header with Stats -->
  <div class="page-header">
    <div class="breadcrumb-nav">
      <a routerLink="/customer/home" class="breadcrumb-link">
        <i class="fas fa-home"></i>
        <span>Home</span>
      </a>
      <i class="fas fa-chevron-right breadcrumb-separator"></i>
      <span class="breadcrumb-current">My Orders</span>
    </div>

    <div class="header-main">
      <div class="header-left">
        <div class="header-title-section">
          <h1>
            <i class="fas fa-shopping-bag"></i>
            My Orders
          </h1>
          <p class="header-subtitle">Track and manage all your orders in one place</p>
        </div>

        <!-- Inline Stats -->
        <!-- <div class="header-stats" *ngIf="!loading && !error && orders.length > 0">
          <div class="stat-item">
            <div class="stat-number">{{ orders.length }}</div>
            <div class="stat-text">Total</div>
          </div>
          <div class="stat-divider">|</div>
          <div class="stat-item pending">
            <div class="stat-number">{{ getPendingOrders() }}</div>
            <div class="stat-text">Pending</div>
          </div>
          <div class="stat-divider">|</div>
          <div class="stat-item completed">
            <div class="stat-number">{{ getCompletedOrders() }}</div>
            <div class="stat-text">Completed</div>
          </div>
          <div class="stat-divider">|</div>
          <div class="stat-item">
            <div class="stat-number">{{ getShippedOrders() }}</div>
            <div class="stat-text">Shipped</div>
          </div>
          <div class="stat-divider">|</div>
          <div class="stat-item">
            <div class="stat-number">{{ getCancelledOrders() }}</div>
            <div class="stat-text">Cancelled</div>
          </div>
        </div> -->
      </div>

      <button class="btn-back" (click)="goBackToHome()">
        <i class="fas fa-arrow-left"></i>
        <span>Back to Shop</span>
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-section">
    <div class="loading-card">
      <div class="loading-spinner">
        <div class="spinner-ring"></div>
        <div class="spinner-ring"></div>
        <div class="spinner-ring"></div>
      </div>
      <h3>Loading your orders...</h3>
      <p>Please wait while we fetch your order history</p>
    </div>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !loading" class="error-section">
    <div class="error-card">
      <div class="error-icon">
        <i class="fas fa-exclamation-triangle"></i>
      </div>
      <h3>Something went wrong</h3>
      <p>{{ error }}</p>
      <button class="btn-retry" (click)="loadOrders()">
        <i class="fas fa-redo"></i>
        <span>Try Again</span>
      </button>
    </div>
  </div>

  <!-- Empty State -->
  <div *ngIf="!loading && !error && orders.length === 0" class="empty-section">
    <div class="empty-card">
      <div class="empty-illustration">
        <i class="fas fa-shopping-bag"></i>
        <div class="empty-dots">
          <span></span>
          <span></span>
          <span></span>
        </div>
      </div>
      <h3>No orders found</h3>
      <p>You haven't placed any orders yet. Start shopping to see your orders here!</p>
      <button class="btn-start-shopping" (click)="goBackToHome()">
        <i class="fas fa-shopping-cart"></i>
        <span>Start Shopping</span>
      </button>
    </div>
  </div>

  <!-- Orders Content -->
  <div *ngIf="!loading && !error && orders.length > 0" class="orders-section">

    <!-- Professional Controls with Dropdown Filter -->
    <div class="controls-section">
      <div class="controls-header">
        <h6 class="controls-title">
          {{ getFilterTitle() }}
          <span class="filter-badge">{{ filteredOrders.length }}</span>
        </h6>
      </div>

      <div class="controls-actions">
        <div class="search-box">
          <i class="fas fa-search"></i>
          <input type="text" placeholder="Search orders by tracking number or product..."
            (input)="onSearchChange($event)" [value]="searchTerm">
        </div>

        <!-- Dropdown Filter -->
        <div class="filter-dropdown">
          <button class="filter-btn" (click)="toggleDropdown()" [class.active]="dropdownOpen">
            <i class="fas fa-filter"></i>
            <span>{{ getFilterLabel() }}</span>
            <i class="fas fa-chevron-down" [style.transform]="dropdownOpen ? 'rotate(180deg)' : 'rotate(0deg)'"></i>
          </button>

          <div class="filter-dropdown-menu" [class.show]="dropdownOpen">
            <button class="filter-dropdown-item" [class.active]="selectedFilter === 'all'"
              (click)="selectFilter('all')">
              All Orders
              <span class="filter-count">{{ getFilteredOrdersCount('all') }}</span>
            </button>
            <div class="filter-dropdown-divider"></div>
            <button class="filter-dropdown-item" [class.active]="selectedFilter === 'pending'"
              (click)="selectFilter('pending')">
              Pending
              <span class="filter-count">{{ getFilteredOrdersCount('pending') }}</span>
            </button>
            <button class="filter-dropdown-item" [class.active]="selectedFilter === 'paid'"
              (click)="selectFilter('paid')">
              Paid
              <span class="filter-count">{{ getFilteredOrdersCount('paid') }}</span>
            </button>
            <button class="filter-dropdown-item" [class.active]="selectedFilter === 'shipped'"
              (click)="selectFilter('shipped')">
              Shipped
              <span class="filter-count">{{ getFilteredOrdersCount('shipped') }}</span>
            </button>
            <button class="filter-dropdown-item" [class.active]="selectedFilter === 'delivered'"
              (click)="selectFilter('delivered')">
              Delivered
              <span class="filter-count">{{ getFilteredOrdersCount('delivered') }}</span>
            </button>
            <button class="filter-dropdown-item" [class.active]="selectedFilter === 'cancelled'"
              (click)="selectFilter('cancelled')">
              Cancelled
              <span class="filter-count">{{ getFilteredOrdersCount('cancelled') }}</span>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Professional Orders Table -->
    <div class="orders-container">
      <table class="orders-table">
        <thead>
          <tr>
            <th>Order Details</th>
            <th>Items</th>
            <th>Payment</th>
            <th>Status</th>
            <th>Total</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let order of paginatedOrders; trackBy: trackByOrderId" class="order-row"
            (click)="viewOrderDetail(order.id)">

            <!-- Order Details Column -->
            <td>
              <div class="order-number">#{{ order.trackingNumber }}</div>
              <div class="order-date">
                <i class="fas fa-calendar-alt"></i>
                {{ formatDate(order.createdDate) }}
              </div>
              <div *ngIf="order.paymentMethod || order.paymentType" class="payment-info">
                <i [class]="getPaymentMethodIcon(order)" [ngClass]="getPaymentMethodClass(order)"></i>
                {{ getPaymentMethodName(order) }}
              </div>
            </td>

            <!-- Items Column -->
            <td>
              <div class="items-preview">
                <div *ngFor="let item of order.items.slice(0, 3)" class="item-image">
                  <img [src]="item.variant.imgPath || item.product.imgPath" [alt]="item.product.name"
                    (error)="onImageError($event)">
                  <span class="item-qty">{{ item.quantity }}</span>
                </div>
                <div *ngIf="order.items.length > 3" class="more-items">
                  +{{ order.items.length - 3 }}
                </div>
              </div>
              <div class="items-count">{{ getTotalItems(order) }} items</div>
            </td>

            <!-- Payment Column -->
            <td>
              <div>Subtotal: {{ formatCurrency(getSubtotal(order)) }}</div>
              <div>Shipping: {{ formatCurrency(order.shippingFee) }}</div>
            </td>

            <!-- Status Column -->
            <td>
              <span class="status-badge" [ngClass]="getOrderStatusClass(order.paymentStatus)">
                <i [class]="getOrderStatusIcon(order.paymentStatus)"></i>
                {{ order.paymentStatus }}
              </span>
            </td>

            <!-- Total Column -->
            <td>
              <div class="order-total">{{ formatCurrency(order.totalAmount) }}</div>
            </td>

            <!-- Actions Column -->
            <td>
              <button class="btn-view-order" (click)="viewOrderDetail(order.id); $event.stopPropagation()">
                <i class="fas fa-eye"></i>
                <span>View</span>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Pagination Controls -->
    <div class="pagination-controls">
      <div class="pagination-buttons">
        <button (click)="prevPage()" [disabled]="currentPage === 1">&laquo; Prev</button>
        <ng-container *ngFor="let page of [].constructor(totalPages); let i = index">
          <button (click)="goToPage(i + 1)" [class.active]="currentPage === i + 1">
            {{ i + 1 }}
          </button>
        </ng-container>
        <button (click)="nextPage()" [disabled]="currentPage === totalPages">Next &raquo;</button>
      </div>
      <div class="pagination-size">
        <label for="pageSizeSelect">Rows per page:</label>
        <select id="pageSizeSelect" #pageSizeSelect (change)="setPageSize(+pageSizeSelect.value)">
          <option [selected]="pageSize == 5" value="5">5</option>
          <option [selected]="pageSize == 10" value="10">10</option>
          <option [selected]="pageSize == 20" value="20">20</option>
          <option [selected]="pageSize == 50" value="50">50</option>
        </select>
      </div>
    </div>

    <!-- No Results -->
    <div *ngIf="filteredOrders.length === 0" class="no-results">
      <div class="no-results-icon">
        <i class="fas fa-search"></i>
      </div>
      <h3>No orders found</h3>
      <p>Try adjusting your search or filter criteria</p>
      <button class="btn-clear-filters" (click)="clearFilters()">
        Clear Filters
      </button>
    </div>
  </div>
</main>