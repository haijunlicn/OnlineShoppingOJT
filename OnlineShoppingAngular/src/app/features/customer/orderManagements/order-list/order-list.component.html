<app-header></app-header>

  <div class="main-container">
    <!-- Hero Section -->
    <div class="hero-section">
      <div class="hero-content">
        <div class="breadcrumb-nav">
          <a routerLink="/customer/home" class="breadcrumb-link">
            <i class="fas fa-home"></i>
            <span>Home</span>
          </a>
          <i class="fas fa-chevron-right breadcrumb-separator"></i>
          <span class="breadcrumb-current">My Orders</span>
        </div>
        
        <div class="hero-header">
          <div class="hero-text">
            <h1 class="hero-title">
              <i class="fas fa-shopping-bag"></i>
              My Orders
            </h1>
            <p class="hero-subtitle">Track and manage all your orders in one place</p>
          </div>
          <button class="btn-back" (click)="goBackToHome()">
            <i class="fas fa-arrow-left"></i>
            <span>Back to Shop</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="loading" class="loading-section">
      <div class="loading-card">
        <div class="loading-spinner">
          <div class="spinner-ring"></div>
          <div class="spinner-ring"></div>
          <div class="spinner-ring"></div>
        </div>
        <h3>Loading your orders...</h3>
        <p>Please wait while we fetch your order history</p>
      </div>
    </div>

    <!-- Error State -->
    <div *ngIf="error && !loading" class="error-section">
      <div class="error-card">
        <div class="error-icon">
          <i class="fas fa-exclamation-triangle"></i>
        </div>
        <h3>Something went wrong</h3>
        <p>{{ error }}</p>
        <button class="btn-retry" (click)="loadOrders()">
          <i class="fas fa-redo"></i>
          <span>Try Again</span>
        </button>
      </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="!loading && !error && orders.length === 0" class="empty-section">
      <div class="empty-card">
        <div class="empty-illustration">
          <i class="fas fa-shopping-bag"></i>
          <div class="empty-dots">
            <span></span>
            <span></span>
            <span></span>
          </div>
        </div>
        <h3>No orders found</h3>
        <p>You haven't placed any orders yet. Start shopping to see your orders here!</p>
        <button class="btn-start-shopping" (click)="goBackToHome()">
          <i class="fas fa-shopping-cart"></i>
          <span>Start Shopping</span>
        </button>
      </div>
    </div>

    <!-- Orders Content -->
    <div *ngIf="!loading && !error && orders.length > 0" class="orders-section">
      
      <!-- Statistics Cards -->
      <div class="stats-grid">
        <div class="stat-card total">
          <div class="stat-icon">
            <i class="fas fa-box"></i>
          </div>
          <div class="stat-content">
            <h3>{{ orders.length }}</h3>
            <p>Total Orders</p>
          </div>
        </div>
        
        <div class="stat-card pending">
          <div class="stat-icon">
            <i class="fas fa-clock"></i>
          </div>
          <div class="stat-content">
            <h3>{{ getPendingOrders() }}</h3>
            <p>Pending</p>
          </div>
        </div>
        
        <div class="stat-card completed">
          <div class="stat-icon">
            <i class="fas fa-check-circle"></i>
          </div>
          <div class="stat-content">
            <h3>{{ getCompletedOrders() }}</h3>
            <p>Completed</p>
          </div>
        </div>

        <div class="stat-card shipped">
          <div class="stat-icon">
            <i class="fas fa-shipping-fast"></i>
          </div>
          <div class="stat-content">
            <h3>{{ getShippedOrders() }}</h3>
            <p>Shipped</p>
          </div>
        </div>

        <div class="stat-card cancelled">
          <div class="stat-icon">
            <i class="fas fa-ban"></i>
          </div>
          <div class="stat-content">
            <h3>{{ getCancelledOrders() }}</h3>
            <p>Cancelled</p>
          </div>
        </div>
      </div>

      <!-- Filters and Search -->
      <div class="controls-section">
        <div class="search-box">
          <i class="fas fa-search"></i>
          <input 
            type="text" 
            placeholder="Search orders by tracking number or product..."
            (input)="onSearchChange($event)"
            [value]="searchTerm">
        </div>
        
        <div class="filter-tabs">
          <button 
            class="filter-tab" 
            [class.active]="selectedFilter === 'all'"
            (click)="filterOrders('all')">
            All Orders
            <span class="filter-count">{{ getFilteredOrdersCount('all') }}</span>
          </button>
          <button 
            class="filter-tab" 
            [class.active]="selectedFilter === 'pending'"
            (click)="filterOrders('pending')">
            Pending
            <span class="filter-count">{{ getFilteredOrdersCount('pending') }}</span>
          </button>
          <button 
            class="filter-tab" 
            [class.active]="selectedFilter === 'paid'"
            (click)="filterOrders('paid')">
            Paid
            <span class="filter-count">{{ getFilteredOrdersCount('paid') }}</span>
          </button>
          <button 
            class="filter-tab" 
            [class.active]="selectedFilter === 'delivered'"
            (click)="filterOrders('delivered')">
            Delivered
            <span class="filter-count">{{ getFilteredOrdersCount('delivered') }}</span>
          </button>
        </div>
      </div>

      <!-- Orders Grid -->
      <div class="orders-grid">
        <div 
          *ngFor="let order of filteredOrders; trackBy: trackByOrderId" 
          class="order-card"
          (click)="viewOrderDetail(order.id)">
          
          <div class="order-header">
            <div class="order-info">
              <h3 class="order-number">#{{ order.trackingNumber }}</h3>
              <p class="order-date">
                <i class="fas fa-calendar-alt"></i>
                {{ formatDate(order.createdDate) }}
              </p>
            </div>
            <div class="order-status">
              <span class="status-badge" [ngClass]="getOrderStatusClass(order.paymentStatus)">
                <i [class]="getOrderStatusIcon(order.paymentStatus)"></i>
                {{ order.paymentStatus }}
              </span>
            </div>
          </div>

          <div class="order-body">
            <div class="order-items">
              <div class="items-preview">
                <div *ngFor="let item of order.items.slice(0, 4)" class="item-image">
                  <img 
                    [src]="item.variant.imgPath || item.product.imgPath" 
                    [alt]="item.product.name"
                    (error)="onImageError($event)">
                  <span class="item-qty">x{{ item.quantity }}</span>
                </div>
                <div *ngIf="order.items.length > 4" class="more-items">
                  +{{ order.items.length - 4 }} more
                </div>
              </div>
              <div class="items-summary">
                <span class="items-count">{{ getTotalItems(order) }} items</span>
              </div>
            </div>

            <div class="order-pricing">
              <div class="price-row">
                <span>Subtotal:</span>
                <span>{{ formatCurrency(getSubtotal(order)) }}</span>
              </div>
              <div class="price-row">
                <span>Shipping:</span>
                <span>{{ formatCurrency(order.shippingFee) }}</span>
              </div>
              <div class="price-divider"></div>
              <div class="price-row total">
                <span>Total:</span>
                <span class="total-amount">{{ formatCurrency(order.totalAmount) }}</span>
              </div>
            </div>
          </div>

          <div class="order-footer">
            <button 
              class="btn-view-order" 
              (click)="viewOrderDetail(order.id); $event.stopPropagation()">
              <i class="fas fa-eye"></i>
              <span>View Details</span>
            </button>
          </div>
        </div>
      </div>

      <!-- No Results -->
      <div *ngIf="filteredOrders.length === 0" class="no-results">
        <div class="no-results-icon">
          <i class="fas fa-search"></i>
        </div>
        <h3>No orders found</h3>
        <p>Try adjusting your search or filter criteria</p>
        <button class="btn-clear-filters" (click)="selectedFilter = 'all'; searchTerm = ''; applyFilters()">
          Clear Filters
        </button>
      </div>
    </div>
  </div>
